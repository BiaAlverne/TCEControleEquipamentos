{% extends "equipamentos/base.html" %}
{% block content %}
<div class="container mt-5">
  <h2 class="mb-4 fw-bold">Cadastro de Usuário</h2>

  <form method="post">
    {% csrf_token %}

    <div class="mb-3">
      <label class="form-label">Usuário</label>
      <input type="text" class="form-control" name="username" required>
    </div>

    <div class="mb-3">
      <label class="form-label">E-mail</label>
      <input type="email" class="form-control" name="email" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Senha</label>
      <input type="password" class="form-control" name="password1" minlength="8" maxlength="8" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Confirmar Senha</label>
      <input type="password" class="form-control" name="password2" minlength="8" maxlength="8" required>
    </div>

    <hr>

    <h4 class="mt-4 fw-semibold">Endereço</h4>

    <div class="mb-3">
      <label class="form-label">CEP</label>
      <input type="text" class="form-control" id="cep" placeholder="Apenas 8 dígitos" name="cep" minlength="8" maxlength="8" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Endereço</label>
      <input type="text" class="form-control" id="endereco" name="endereco" readonly>
    </div>

    <div class="mb-3">
      <label class="form-label">Bairro</label>
      <input type="text" class="form-control" id="bairro" name="bairro" readonly>
    </div>

    <div class="mb-3">
      <label class="form-label">Número</label>
      <input type="text" class="form-control" id="numero" name="numero" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Complemento</label>
      <input type="text" class="form-control" id="complemento" name="complemento">
    </div>

    <div class="mb-3">
      <label class="form-label">Cidade</label>
      <input type="text" class="form-control" id="cidade" name="cidade" readonly>
    </div>

    <div class="mb-3">
      <label class="form-label">Estado</label>
      <input type="text" class="form-control" id="estado" name="estado" readonly>
    </div>

    <div class="form-check mt-3 mb-3">
      <input class="form-check-input" type="checkbox" id="tem_equipamento" name="tem_equipamento">
      <label class="form-check-label" for="tem_equipamento">
        Possui equipamento em casa?
      </label>
    </div>

    <button type="submit" class="btn btn-success">Cadastrar</button>
  </form>

  <p class="mt-3">Já tem uma conta? <a href="{% url 'login' %}">Faça login</a></p>

  <!--Script para buscar endereço via API do ViaCEP-->
  <script>
    document.getElementById('cep').addEventListener('blur', function() {
      const cep = this.value.replace(/\D/g, '');
      if (cep.length === 8) {
        fetch(`https://viacep.com.br/ws/${cep}/json/`)
          .then(response => response.json())
          .then(data => {
            if (!data.erro) {
              document.getElementById('endereco').value = data.logradouro;
              document.getElementById('bairro').value = data.bairro;
              document.getElementById('cidade').value = data.localidade;
              document.getElementById('estado').value = data.uf;
            } else {
              alert('CEP não encontrado!');
            }
          })
          .catch(() => {
            alert('Erro ao buscar o CEP!');
          });
      }
    })
  </script>

</div>
{% endblock %}
